<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' https://api.github.com https://raw.githubusercontent.com; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self';" />
  <title>EasyWorship MVP</title>

  <!-- Your existing global styles -->
  <link rel="stylesheet" href="style.css" />

  <!-- Layout for split slide + bottom verse panel -->
  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      display: flex;
      flex-direction: column;
    }

    :root {
      --preview-aspect: 56.25%; /* Default 16:9 */
    }

    /* Top slide area: preview on left, live on right */
    #slide-container {
      flex: 1 1 auto;
      display: flex;
      overflow: hidden;
    }
    #slide-preview, #slide-live {
      flex: 1 1 50%;
      overflow: auto;
      padding: 0;
      box-sizing: border-box;
      position: relative;
    }

    /* Preview content with aspect ratio */
    #preview-container {
      position: relative;
      width: 100%;
      height: 0;
      padding-bottom: var(--preview-aspect, 56.25%); /* Default 16:9 */
      background: #000;
      overflow: hidden;
    }
    #preview-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      color: white;
      font-family: Arial, sans-serif;
      padding: 20px;
      box-sizing: border-box;
    }
    #verse-number {
      font-size: 1.5em;
      align-self: flex-start;
      vertical-align: super;
      line-height: 1;
    }
    #verse-text {
      font-size: 2em;
      text-align: center;
      flex: 1;
      overflow-wrap: break-word;
      word-break: break-word;
      max-width: 100%;
      padding: 0 10px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    /* Style for inline verse numbers when concatenating passages */
    #verse-text p, #verse-display p { margin: 0; }
    #verse-text p sub.verse-num, #verse-display p sub.verse-num {
      font-size: 0.65em;
      vertical-align: sub;
      margin-right: 6px;
      opacity: 0.85;
    }
    #verse-reference {
      font-size: 0.8em;
      align-self: flex-end;
      margin-top: auto;
    }

    /* Live content - same aspect as preview */
    #live-container {
      position: relative;
      width: 100%;
      padding-bottom: var(--preview-aspect, 56.25%); /* Same aspect as preview */
      background: #000;
      overflow: hidden;
    }
    #live-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      color: white;
      font-family: Arial, sans-serif;
      padding: 20px;
      box-sizing: border-box;
    }
    #live-number {
      font-size: 1.5em;
      align-self: flex-start;
      vertical-align: super;
      line-height: 1;
    }
    #live-text {
      font-size: 2em;
      text-align: center;
      flex: 1;
      overflow-wrap: break-word;
      word-break: break-word;
      max-width: 100%;
      padding: 0 10px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #live-reference {
      font-size: 0.8em;
      align-self: flex-end;
      margin-top: auto;
    }

    /* Bottom verse panel: fixed height, two columns */
    #verse-panel {
      flex: 0 0 200px; /* fixed 200px tall */
      display: flex;
      height: 200px;
      flex-direction: column;
    }
    /* Verse list on left: width determined by JS via CSS variable */
    #verse-list {
      flex: 0 0 auto;
      width: var(--verse-list-width, 150px);
      overflow-y: auto;
      background: #fff;
    }
    /* Verse display on right: scrollable */
    #verse-display {
      flex: 1 1 auto;
      overflow-y: auto;
      padding: 8px;
      background: #fafafa;
    }

    /* Highlighting style for search results */
    .search-selected {
      background: yellow;
    }

    button.active {
      background: #0074d9 !important;
      color: white !important;
    }
  </style>
</head>
<body>
  <div style="display: flex; flex-direction: column; height: 100vh;">
    <!-- Top section: Schedule sidebar + Preview canvases -->
    <div id="top-section" style="display: flex; flex: 0 0 calc(100vh - 216px); overflow: hidden; min-height: 0;">
      <!-- Schedule Sidebar -->
      <div id="schedule-sidebar" style="width: 250px; display: flex; flex-direction: column;">
        <div id="schedule-header" style="padding: 10px; font-weight: bold;">
          Schedule
        </div>
        <div id="schedule-list" style="flex: 1; overflow-y: auto; padding: 5px;">
          <!-- Schedule items will be added here -->
        </div>
      </div>
      
      <!-- Resizer between schedule and previews -->
      <div class="resizer resizer-x" id="schedule-resizer" style="width: 16px; cursor: col-resize; flex-shrink: 0;"></div>
      
      <!-- Slide preview + live view -->
      <div id="slide-container" style="flex: 1; display: flex; min-width: 0;">
        <div id="slide-preview" style="flex: 1; overflow: hidden; min-width: 0;">
          <canvas id="preview-canvas" style="width: 100%; height: 100%; object-fit: contain;"></canvas>
        </div>
        
        <!-- Resizer between preview and live -->
        <div class="resizer resizer-x" id="preview-resizer" style="width: 16px; cursor: col-resize; flex-shrink: 0;"></div>
        
        <div id="slide-live" style="flex: 1; overflow: hidden; min-width: 0;">
          <canvas id="live-canvas" style="width: 100%; height: 100%; object-fit: contain;"></canvas>
        </div>
      </div>
    </div>

    <!-- Resizer between previews and verse panel -->
    <div class="resizer resizer-y" id="verse-resizer" style="height: 16px; cursor: row-resize; flex-shrink: 0;"></div>

    <!-- Bottom verse selection and display -->
    <div id="verse-panel" style="flex: 0 0 200px; min-height: 0;">
      <!-- Control buttons (persist across tabs) -->
      <div id="control-buttons-container" style="display: flex; gap: 5px; padding: 8px; border-bottom: 1px solid #ccc; background: #f5f5f5; justify-content: flex-end;"></div>
      
      <!-- Tabs -->
      <div id="bottom-tabs" style="display: flex; border-bottom: 1px solid #ccc;">
        <button class="bottom-tab active" data-tab="verses" style="padding: 8px 16px; border: none; background: transparent; cursor: pointer; border-bottom: 2px solid #0078d4;">Verses</button>
        <button class="bottom-tab" data-tab="songs" style="padding: 8px 16px; border: none; background: transparent; cursor: pointer;">Songs</button>
      </div>
      
      <!-- Verses Tab Content -->
      <div id="verses-tab-content" class="tab-content" style="display: flex; flex-direction: column; flex: 1; min-height: 0;">
        <div id="scripture-search" style="flex-shrink: 0;">
          <div id="search-box-container" style="width:100%"></div>
        </div>
        <div id="verse-content-row" style="display: flex; flex: 1; min-height: 0;">
          <div id="verse-list">
            <div id="virtual-list"></div>
          </div>
          <div id="verse-display"></div>
        </div>
      </div>
      
      <!-- Songs Tab Content -->
      <div id="songs-tab-content" class="tab-content" style="display: none; flex-direction: column; flex: 1; min-height: 0;">
        <div id="song-search" style="flex-shrink: 0; padding: 1em; display: flex; gap: 8px; align-items: center;">
          <input type="text" id="song-search-input" placeholder="Search songs by title or lyrics..." style="flex: 1; padding: 6px; box-sizing: border-box;" />
          <button id="song-view-toggle" style="padding: 6px 12px; white-space: nowrap;" title="Toggle between full song and verse blocks">Verse Blocks</button>
        </div>
        <div style="display: flex; flex: 1; min-height: 0;">
          <div id="song-list" style="flex: 0 0 200px; overflow-y: auto; position: relative; border: 1px solid #ccc;">
            <div id="song-virtual-list" style="position: relative;"></div>
          </div>
          <div id="song-display" style="flex: 1; padding: 10px; border: 1px solid #ccc; border-left: none; overflow-y: auto;">
            <!-- Selected song details will be shown here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Search box and list example -->

  <script src="renderer.js"></script>
  <script src="searchBox.js"></script>
  <script>
  window.addEventListener('DOMContentLoaded', () => {
    setupSearchBox({ containerId: 'search-box-container', targetDivId: 'verse-list' });
  });
</script>

<!-- CSS Editing Popover -->
<div id="css-popover" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; border:1px solid #ccc; padding:20px; z-index:1000; box-shadow: 0 0 10px rgba(0,0,0,0.5);">
  <h3>Edit CSS for <span id="css-element-name"></span></h3>
  <textarea id="css-textarea" rows="10" cols="50" placeholder="Enter CSS rules without braces, e.g. color: red; font-size: 24px;"></textarea>
  <select id="css-select" style="display:none; width:100%; padding:4px;">
    <option value="small">Small</option>
    <option value="medium">Medium</option>
    <option value="large">Large</option>
  </select>
  <br><br>
  <button id="css-save">Save</button>
  <button id="css-cancel">Cancel</button>
  <div id="css-error" style="color:red; margin-top:10px;"></div>
</div>
</body>
</html>
